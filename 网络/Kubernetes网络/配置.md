# 配置

## ConfigMap

在[ConfigMap](https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/)中你可以选择配置以下：

- `debug` - 设置调试模式，更多的日志，`cilium-dbg monitor`也会展示更多内容。
- `enable-ipv4` - 启用IPv4
- `enable-ipv6` - 启用IPv6
- `clean-cilium-bpf-state` - 启动时删除文件系统中所有eBPF状态。Endpoint的IP不变，但是进行中的连接可能会有短暂的干扰，负载均衡决策也会丢失，因此经过负载均衡的活跃链接会中断。所有的eBPF状态会根据最初的来源（比如来自Kubernetes或kvstore）进行重建。这可以用来处理一些eBPF map方面遇到的严重问题。重启后这个选项就应该关掉了。
- `clean-cilium-state` - 删除**所有**Cilium的状态，包括那些无法找回的信息，比如所有endpoint的状态，以及一些可恢复的状态，比如已经被钉（pin）在文件系统、CNI配置文件、库代码、链接、路由等其它信息上的eBPF状态。**该操作无法撤销**。已存在的endpoint也许还会继续工作，但Cilium已经不管它们了，它们可能在没有任何警告信息的情况下就停止工作了。触发该操作后，endpoint必须断掉重连，让Cilium的新实例来接管。
- `monitor-aggregation` - 可以聚合`cilium-dbg monitor`中的跟踪事件，只对活动的流量，或者那些涉及到4层连接状态变更的数据包做周期性的更新。可选参数包括以下：
    - `none` - 为每个收发的数据包生成一个跟踪事件。
    - `low` - 为每个发送的数据包生成一个跟踪事件。
    - `medium` - 为每个新的连接生成一个跟踪事件，以及当数据包在它的方向上出现一个之前没有过的TCP flag时，以及每`monitor-aggregation-interval`生成一个跟踪事件（假设在一个间隔中至少有一个数据包出现）。每个方向上跟踪TCP标志并以各自的间隔分别上报。如果Cilium丢弃了某个数据包，那么每丢弃一个数据包就会发出一个事件。
    - `maxium` - 最大程度的聚合。目前其实等价于`medium`。
- `monitor-aggregation-interval` - 设置跟踪事件报告间隔。仅适用于`medium`及更高级别。假设每个间隔中都至少有一个新的数据包发出，那么可以确保平均每个间隔都有一个事件产生。
- 